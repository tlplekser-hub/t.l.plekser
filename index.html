<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор идей для плакатов</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #2d3436 0%, #000000 100%);
            padding: 20px;
        }
        .container { text-align: center; max-width: 900px; width: 100%; }
        h1 { color: #fff; font-size: 42px; margin-bottom: 40px; font-weight: 700; }
        .start-screen, .result-screen { display: none; }
        .start-screen.active, .result-screen.active { display: block; }
        .description {
            color: #b2bec3; font-size: 18px; line-height: 1.6; margin-bottom: 50px;
            max-width: 600px; margin-left: auto; margin-right: auto;
        }
        button {
            background: #fff; color: #000; border: none; padding: 20px 60px;
            font-size: 24px; font-weight: 600; border-radius: 16px; cursor: pointer;
            transition: all 0.3s ease; box-shadow: 0 10px 30px rgba(255, 255, 255, 0.2);
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(255,255,255,0.3); }
        button:active { transform: translateY(-1px); }
        button:disabled { opacity: .5; cursor: not-allowed; transform: none; }
        .loading { display: none; color: #fff; font-size: 20px; margin-top: 30px; }
        .loading.active { display: block; }
        .spinner {
            border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #fff;
            border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0%{transform:rotate(0);}100%{transform:rotate(360deg);} }
        .results { display:flex; justify-content:center; gap:30px; margin-bottom:30px; flex-wrap:wrap; }
        .result-box {
            background:#fff; border-radius:20px; padding:40px 30px; width:250px;
            box-shadow:0 10px 40px rgba(0,0,0,0.3); transition:transform .3s ease;
        }
        .result-box:hover { transform: translateY(-5px); }
        .result-label { font-size:14px; color:#636e72; text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; font-weight:600; }
        .result-source { font-size:12px; color:#b2bec3; margin-bottom:10px; min-height:16px; }
        .result-word { font-size:32px; color:#000; font-weight:700; word-wrap:break-word; }
        .status-text { color:#b2bec3; font-size:16px; margin-top:20px; min-height:24px; }
        .sources-link { color:#fff; text-decoration:underline; cursor:pointer; font-size:16px; margin-bottom:30px; display:inline-block; transition:color .3s ease; }
        .sources-link:hover { color:#b2bec3; }
        .modal {
            display:none; position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000;
        }
        .modal.active { display:flex; }
        .modal-content {
            background:#fff; border-radius:20px; padding:40px; max-width:650px; width:90%;
            max-height:80vh; overflow-y:auto; position:relative;
            box-shadow:0 20px 60px rgba(0,0,0,0.5);
        }
        .modal-close {
            position:sticky; top:0; float:right; margin:-20px -20px 20px 20px;
            background:#000; color:#fff; border:none; width:35px; height:35px;
            border-radius:50%; font-size:24px; cursor:pointer; display:flex;
            align-items:center; justify-content:center; padding:0; line-height:1;
            transition:background .3s ease; z-index:10;
        }
        .modal-close:hover { background:#333; transform:none; }
        .modal h2 { color:#000; margin-bottom:20px; font-size:28px; clear:both; }
        .source-section { margin-bottom:30px; }
        .source-section:last-child { margin-bottom:0; }
        .source-section-title { color:#636e72; font-size:14px; text-transform:uppercase; letter-spacing:1px; margin-bottom:15px; font-weight:600; }
        .source-item { margin-bottom:15px; padding-bottom:15px; border-bottom:1px solid #e0e0e0; }
        .source-item:last-child { border-bottom:none; }
        .source-title { color:#000; font-weight:600; margin-bottom:8px; font-size:15px; line-height:1.4; }
        .source-link { color:#0984e3; text-decoration:none; font-size:13px; word-break:break-all; }
        .source-link:hover { text-decoration:underline; }
        .no-sources { color:#999; font-style:italic; font-size:14px; }
    </style>
</head>
<body>
<div class="container">
    <div class="start-screen active">
        <h1>Генератор идей для плакатов</h1>
        <p class="description">
            Программа анализирует актуальные мировые новости и находит самые популярные слова,
            упоминания цветов и форм для вдохновения в создании дизайна плакатов.
        </p>
        <button onclick="startGeneration()">Начать</button>
        <div class="loading">
            <div class="spinner"></div>
            <p class="status-text" id="status">Анализируем новости...</p>
        </div>
    </div>

    <div class="result-screen">
        <h1>Ваши идеи для плаката</h1>
        <div class="results">
            <div class="result-box">
                <div class="result-label">Ключевое слово</div>
                <div class="result-source" id="word1Source">Источник: —</div>
                <div class="result-word" id="word1">—</div>
            </div>
            <div class="result-box">
                <div class="result-label">Стиль</div>
                <div class="result-source" id="word2Source">Источник: —</div>
                <div class="result-word" id="word2">—</div>
            </div>
            <div class="result-box">
                <div class="result-label">Форма</div>
                <div class="result-source" id="word3Source">Источник: —</div>
                <div class="result-word" id="word3">—</div>
            </div>
        </div>
        <div>
            <span class="sources-link" onclick="showSources()">Источники</span>
        </div>
        <button onclick="repeatGeneration()" id="repeatBtn">Повторить</button>
    </div>
</div>

<div class="modal" id="sourcesModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeSources()">×</button>
        <h2>Источники</h2>
        <div id="sourcesList"></div>
    </div>
</div>

<script>
    let keywordSources = [];
    let colorSources = [];
    let shapeSources = [];
    let currentKeyword = '';

    const colorDictionary = {
        'red':'красный','blue':'синий','green':'зелёный','yellow':'жёлтый','black':'чёрный','white':'белый',
        'orange':'оранжевый','purple':'фиолетовый','pink':'розовый','brown':'коричневый','gray':'серый','grey':'серый',
        'beige':'бежевый','gold':'золотой','silver':'серебряный','cyan':'циановый','magenta':'пурпурный',
        'golden':'золотой','cream':'кремовый','teal':'бирюзовый'
    };

    const colorStyleDictionary = {
        'neon':'неоновый','pastel':'пастельный','vibrant':'яркий','muted':'приглушённый','monochrome':'монохромный',
        'gradient':'градиентный','duotone':'дуотональный','fluorescent':'флуоресцентный','bold':'жирный','bright':'яркий',
        'dark':'тёмный','light':'светлый','colorful':'красочный','colourful':'красочный'
    };

    const shapeDictionary = { 
        'circle':'круг','square':'квадрат','triangle':'треугольник','rectangle':'прямоугольник','oval':'овал',
        'sphere':'сфера','cube':'куб','pyramid':'пирамида','star':'звезда','arrow':'стрелка','line':'линия',
        'wave':'волна','spiral':'спираль','cross':'крест','ring':'кольцо','hexagon':'шестиугольник',
        'diamond':'ромб','arc':'дуга','curve':'кривая','angular':'угловатый','round':'круглый',
        'sharp':'острый','curved':'изогнутый','flat':'плоский','geometric':'геометрический','organic':'органический'
    };

    const wordDictionary = {
        'trump':'Трамп','climate':'климат','technology':'технология','health':'здоровье','economy':'экономика','war':'война','peace':'мир','election':'выборы','crisis':'кризис','growth':'рост','change':'изменение','innovation':'инновация','energy':'энергия','future':'будущее','security':'безопасность','market':'рынок','power':'власть','people':'люди','country':'страна','government':'правительство','china':'Китай','russia':'Россия','ukraine':'Украина','europe':'Европа','america':'Америка','asia':'Азия','water':'вода','fire':'огонь','earth':'земля','air':'воздух','space':'космос','pandemic':'пандемия','vaccine':'вакцина','oil':'нефть','gas':'газ','trade':'торговля','conflict':'конфликт','migration':'миграция','border':'граница','police':'полиция','court':'суд','death':'смерть','attack':'атака','military':'армия','missile':'ракета','strike':'удар','city':'город','region':'регион','european':'Европа','dollar':'доллар','euro':'евро'
    };

    async function fetchNews() {
        const sources = [
            'https://rss.nytimes.com/services/xml/rss/nyt/World.xml',
            'https://feeds.bbci.co.uk/news/world/rss.xml',
            'https://www.theguardian.com/world/rss'
        ];
        let allTexts = [];
        let allItems = [];
        for (let source of sources) {
            try {
                const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(source)}`);
                const data = await response.json();
                if (data.items) {
                    data.items.slice(0, 20).forEach(item => {
                        const title = (item.title || '');
                        const desc = (item.description || '');
                        allTexts.push(title + ' ' + desc);
                        allItems.push({ title: title, link: item.link, text: (title + ' ' + desc).toLowerCase() });
                    });
                }
            } catch (e) { console.log('Ошибка загрузки источника:', e); }
        }
        return { text: allTexts.join(' ').toLowerCase(), items: allItems };
    }

    async function fetchDesignText() {
        try {
            const url = 'https://www.itsnicethat.com/graphic-design';
            const response = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent(url));
            const html = await response.text();
            const doc = new DOMParser().parseFromString(html, 'text/html');
            const text = doc.body.innerText || '';
            console.log('Длина текста с дизайнерского сайта:', text.length);
            return { text: text.toLowerCase(), url: url };
        } catch (e) {
            console.log('Ошибка загрузки дизайнерских статей:', e);
            return { text: '', url: '' };
        }
    }

    function findMostCommonNoun(text, items) {
        const words = text.match(/[a-zA-Z]{3,}/g) || [];
        const stopWords = [
            'a','an','the','and','or','but','if','then','else','for','from','to','of','in','on','at','by','with','without','about','above','below','under','over','between','into','through','during','before','after','again','further','once','here','there','when','where','why','how','all','any','both','each','few','more','most','other','some','such','no','nor','not','only','own','same','so','than','too','very','can','could','will','would','shall','should','may','might','must','do','does','did','done','being','been','is','am','are','was','were','be','have','has','had','having','as','it','its','this','that','these','those','he','she','they','we','you','i','his','her','their','our','your','me','him','them','us','who','whom','which','what','because','while','until','though','yet','also','just','still','even','ever','never','today','yesterday','tomorrow','now','new','latest','live','breaking','news','update','updates','video','photo','photos','image','images','said','says','say','told','reports','report','according'
        ];

        const frequency = {};
        words.forEach(w => {
            const word = w.toLowerCase();
            if (!stopWords.includes(word)) {
                frequency[word] = (frequency[word] || 0) + 1;
            }
        });

        let bestDictKey = '';
        let bestDictCount = 0;
        Object.keys(wordDictionary).forEach(key => {
            const count = frequency[key] || 0;
            if (count > bestDictCount) {
                bestDictCount = count;
                bestDictKey = key;
            }
        });

        if (bestDictKey && bestDictCount >= 2) {
            currentKeyword = bestDictKey;
            keywordSources = items.filter(item => item.text.includes(bestDictKey));
            return {
                value: wordDictionary[bestDictKey],
                source: 'существительное из заголовков новостей (' + bestDictCount + ' упоминания)'
            };
        }

        let maxWord = '';
        let maxCount = 0;
        for (let w in frequency) {
            if (frequency[w] > maxCount) {
                maxCount = frequency[w];
                maxWord = w;
            }
        }

        if (maxWord && maxCount >= 2) {
            currentKeyword = maxWord;
            keywordSources = items.filter(item => item.text.includes(maxWord));
            return {
                value: wordDictionary[maxWord] || (maxWord.charAt(0).toUpperCase() + maxWord.slice(1)),
                source: 'ключевое слово по частоте (' + maxCount + ' упоминания)'
            };
        }

        if (bestDictKey && bestDictCount === 1) {
            currentKeyword = bestDictKey;
            keywordSources = items.filter(item => item.text.includes(bestDictKey));
            return {
                value: wordDictionary[bestDictKey],
                source: 'существительное из словаря тем (найдено в новостях 1 раз)'
            };
        }

        const fallbackWords = ['war','climate','technology','economy','energy'];
        const fb = fallbackWords[Math.floor(Math.random() * fallbackWords.length)];
        currentKeyword = fb;
        keywordSources = [];
        return {
            value: wordDictionary[fb] || (fb.charAt(0).toUpperCase() + fb.slice(1)),
            source: 'существительное из словаря тем'
        };
    }

    function findDesignColor(designText, designUrl) {
        colorSources = [];
        if (!designText || designText.length < 50) {
            console.log('Текст слишком короткий для анализа стиля');
            return { value: 'неоновый зелёный', source: 'стиль по умолчанию' };
        }

        const words = designText.match(/[a-zA-Z]{3,}/g) || [];
        const freq = {};
        words.forEach(w => {
            const word = w.toLowerCase();
            freq[word] = (freq[word] || 0) + 1;
        });

        let bestColor = '';
        let bestColorCount = 0;
        Object.keys(colorDictionary).forEach(col => {
            const count = freq[col] || 0;
            if (count > bestColorCount) {
                bestColorCount = count;
                bestColor = col;
            }
        });

        let bestStyle = '';
        let bestStyleCount = 0;
        Object.keys(colorStyleDictionary).forEach(st => {
            const count = freq[st] || 0;
            if (count > bestStyleCount) {
                bestStyleCount = count;
                bestStyle = st;
            }
        });

        console.log('Лучший цвет:', bestColor, 'упоминаний:', bestColorCount);
        console.log('Лучший стиль:', bestStyle, 'упоминаний:', bestStyleCount);

        if (bestColor && bestColorCount >= 1) {
            colorSources = [{ title: 'Its Nice That - Graphic Design (стиль: ' + bestColor + ')', link: designUrl }];
            const base = colorDictionary[bestColor] || bestColor;
            if (bestStyle && bestStyleCount >= 1) {
                return {
                    value: colorStyleDictionary[bestStyle] + ' ' + base,
                    source: 'стиль из дизайнерских статей'
                };
            }
            return {
                value: base,
                source: 'стиль из дизайнерских статей (' + bestColorCount + ' упоминания)'
            };
        }

        if (bestStyle && bestStyleCount >= 1) {
            colorSources = [{ title: 'Its Nice That - Graphic Design (стиль: ' + bestStyle + ')', link: designUrl }];
            return {
                value: colorStyleDictionary[bestStyle],
                source: 'стиль из дизайнерских статей'
            };
        }

        const fallbackColors = [
            { value: 'неоновый розовый', source: 'стиль по умолчанию' },
            { value: 'пастельный голубой', source: 'стиль по умолчанию' },
            { value: 'яркий жёлтый', source: 'стиль по умолчанию' }
        ];
        return fallbackColors[Math.floor(Math.random() * fallbackColors.length)];
    }

    function findDesignShape(designText, designUrl) {
        shapeSources = [];
        if (!designText || designText.length < 50) {
            return { value: 'круг', source: 'форма по умолчанию' };
        }

        const words = designText.match(/[a-zA-Z]{3,}/g) || [];
        const freq = {};
        words.forEach(w => {
            const word = w.toLowerCase();
            freq[word] = (freq[word] || 0) + 1;
        });

        let bestShape = '';
        let bestShapeCount = 0;
        Object.keys(shapeDictionary).forEach(sh => {
            const count = freq[sh] || 0;
            if (count > bestShapeCount) {
                bestShapeCount = count;
                bestShape = sh;
            }
        });

        console.log('Лучшая форма:', bestShape, 'упоминаний:', bestShapeCount);

        if (bestShape && bestShapeCount >= 1) {
            shapeSources = [{ title: 'Its Nice That - Graphic Design (форма: ' + bestShape + ')', link: designUrl }];
            return {
                value: shapeDictionary[bestShape],
                source: 'форма из дизайнерских статей (' + bestShapeCount + ' упоминания)'
            };
        }

        const fallbackShapes = ['circle','square','triangle','line','star'];
        const fbShape = fallbackShapes[Math.floor(Math.random() * fallbackShapes.length)];
        return {
            value: shapeDictionary[fbShape],
            source: 'форма по умолчанию'
        };
    }

    async function startGeneration() {
        document.querySelector('.start-screen button').style.display = 'none';
        document.querySelector('.loading').classList.add('active');
        await performGeneration();
    }

    async function repeatGeneration() {
        document.querySelector('.result-screen').classList.remove('active');
        document.querySelector('.start-screen').classList.add('active');
        document.querySelector('.start-screen button').style.display = 'none';
        document.querySelector('.loading').classList.add('active');
        await performGeneration();
    }

    async function performGeneration() {
        try {
            document.getElementById('status').textContent = 'Собираем мировые новости...';
            await new Promise(r => setTimeout(r, 800));
            const newsData = await fetchNews();
            if (!newsData.text || newsData.text.length < 100) throw new Error('Недостаточно данных для анализа');

            document.getElementById('status').textContent = 'Анализируем заголовки...';
            await new Promise(r => setTimeout(r, 800));
            const word1Obj = findMostCommonNoun(newsData.text, newsData.items);

            document.getElementById('status').textContent = 'Парсим раздел Graphic Design...';
            await new Promise(r => setTimeout(r, 1200));
            const designData = await fetchDesignText();
            const colorObj = findDesignColor(designData.text, designData.url);
            const shapeObj = findDesignShape(designData.text, designData.url);

            document.getElementById('status').textContent = 'Генерируем результаты...';
            await new Promise(r => setTimeout(r, 500));

            document.getElementById('word1').textContent = word1Obj.value;
            document.getElementById('word1Source').textContent = 'Источник: ' + word1Obj.source;
            document.getElementById('word2').textContent = colorObj.value;
            document.getElementById('word2Source').textContent = 'Источник: ' + colorObj.source;
            document.getElementById('word3').textContent = shapeObj.value;
            document.getElementById('word3Source').textContent = 'Источник: ' + shapeObj.source;

            document.querySelector('.start-screen').classList.remove('active');
            document.querySelector('.result-screen').classList.add('active');
        } catch (e) {
            document.getElementById('status').textContent = 'Произошла ошибка при загрузке данных. Попробуйте ещё раз.';
            document.querySelector('.start-screen button').style.display = 'inline-block';
            document.querySelector('.loading').classList.remove('active');
            console.error('Ошибка:', e);
        }
    }

    function showSources() {
        const modal = document.getElementById('sourcesModal');
        const sourcesList = document.getElementById('sourcesList');
        sourcesList.innerHTML = '';

        const keywordSection = document.createElement('div');
        keywordSection.className = 'source-section';
        const keywordTitle = document.createElement('div');
        keywordTitle.className = 'source-section-title';
        keywordTitle.textContent = 'Статьи с ключевым словом (' + currentKeyword + ')';
        keywordSection.appendChild(keywordTitle);

        if (keywordSources.length === 0) {
            const noSources = document.createElement('div');
            noSources.className = 'no-sources';
            noSources.textContent = 'Источники не найдены';
            keywordSection.appendChild(noSources);
        } else {
            keywordSources.forEach(source => {
                const item = document.createElement('div');
                item.className = 'source-item';
                const title = document.createElement('div');
                title.className = 'source-title';
                title.textContent = source.title;
                const link = document.createElement('a');
                link.className = 'source-link';
                link.href = source.link;
                link.textContent = source.link;
                link.target = '_blank';
                item.appendChild(title);
                item.appendChild(link);
                keywordSection.appendChild(item);
            });
        }
        sourcesList.appendChild(keywordSection);

        const colorSection = document.createElement('div');
        colorSection.className = 'source-section';
        const colorTitle = document.createElement('div');
        colorTitle.className = 'source-section-title';
        colorTitle.textContent = 'Статьи со стилем';
        colorSection.appendChild(colorTitle);

        if (colorSources.length === 0) {
            const noSources = document.createElement('div');
            noSources.className = 'no-sources';
            noSources.textContent = 'Стиль выбран по умолчанию';
            colorSection.appendChild(noSources);
        } else {
            colorSources.forEach(source => {
                const item = document.createElement('div');
                item.className = 'source-item';
                const title = document.createElement('div');
                title.className = 'source-title';
                title.textContent = source.title;
                const link = document.createElement('a');
                link.className = 'source-link';
                link.href = source.link;
                link.textContent = source.link;
                link.target = '_blank';
                item.appendChild(title);
                item.appendChild(link);
                colorSection.appendChild(item);
            });
        }
        sourcesList.appendChild(colorSection);

        const shapeSection = document.createElement('div');
        shapeSection.className = 'source-section';
        const shapeTitle = document.createElement('div');
        shapeTitle.className = 'source-section-title';
        shapeTitle.textContent = 'Статьи с формой';
        shapeSection.appendChild(shapeTitle);

        if (shapeSources.length === 0) {
            const noSources = document.createElement('div');
            noSources.className = 'no-sources';
            noSources.textContent = 'Форма выбрана по умолчанию';
            shapeSection.appendChild(noSources);
        } else {
            shapeSources.forEach(source => {
                const item = document.createElement('div');
                item.className = 'source-item';
                const title = document.createElement('div');
                title.className = 'source-title';
                title.textContent = source.title;
                const link = document.createElement('a');
                link.className = 'source-link';
                link.href = source.link;
                link.textContent = source.link;
                link.target = '_blank';
                item.appendChild(title);
                item.appendChild(link);
                shapeSection.appendChild(item);
            });
        }
        sourcesList.appendChild(shapeSection);

        modal.classList.add('active');
    }

    function closeSources() { 
        document.getElementById('sourcesModal').classList.remove('active'); 
    }

    document.getElementById('sourcesModal').addEventListener('click', function(e){ 
        if(e.target===this) closeSources(); 
    });
</script>
</body>
</html>